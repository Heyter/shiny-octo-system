 --#NoSimplerr#local maxitems = CreateConVar( "drp_maxitems", "20", { FCVAR_REPLICATED, FCVAR_ARCHIVE } )local maxitemspremiun = CreateConVar("drp_maxitems_prim","30",{ FCVAR_REPLICATED, FCVAR_ARCHIVE })util.AddNetworkString("clearinv")util.AddNetworkString("item")util.AddNetworkString("itemr")util.AddNetworkString("useitem")util.AddNetworkString("dropitem")local function CreateFolder()	if not file.IsDir("drpinv", "DATA") then        file.CreateDir("drpinv")    endendhook.Add( "Initialize", "FolderCreate", CreateFolder )local function plyjoin(ply)	local strSteamID = string.Replace(ply:SteamID(), ":", "_")	local path = "drpinv/" .. strSteamID .. ".txt"	if file.Exists( path, "DATA" ) then		ply.inv = util.JSONToTable(file.Read(path))		DarkRP.notify(ply, 0, 4, "Welcome back " .. ply:Nick() .. "! Your inventory has been loaded.")	else		ply.inv = {}		ply.inv.maxitems = 0		ply:SaveInv()		DarkRP.notify(ply, 0, 4, "На сервере присутствует постоянный инвентарь, используй предмет Pocket для взаимодействия с ним")	end	ply:SendInv()	ply.canuse = true	endhook.Add("PlayerInitialSpawn","DrpInvSpawn",plyjoin)local function plydis(ply)	ply:SaveInv()	timer.Destroy("canuse" .. ply:UniqueID())endhook.Add("PlayerDisconnected","DrpPlyLeave",plydis)local function plyuse(ply, ent)		if ent:GetClass() == "worldspawn" then return end		local itype = 0		if ent:GetClass() == "spawned_weapon" then			--class = ent:GetWeaponClass()			itype = "swep"		else 						itype = "ent"		end		class = ent:GetClass()		/*if !ply.inv[class] then			ply.inv[class] = 0		end*/		local max = 0		if isDonator(ply) then			max = maxitems:GetInt()		else			max = maxitemspremiun:GetInt()		end		if ply.inv.maxitems >= max then			DarkRP.notify(ply, 1, 4, "Your inventory is full!")						ply.canuse = false			timer.Create("canuse" .. ply:UniqueID(), 1, 1,function() ply.canuse = true end)			return false		end				local item = {}		item["class"] = class		item["itype"] = itype		item["model"] = ent:GetModel()		item["name"] = ent.PrintName		if itype == "swep" then			item["w_class"] = ent:GetWeaponClass()			if ent.ammoadd then				item["ammoadd"] = ent.ammoadd			end			if ent.clip1 then				item["clip1"] = ent.clip1			end			item["name"] = names_helper[ent:GetWeaponClass()].name		end		for k,v in pairs(item) do			print(k,v)		end		ply.inv.maxitems = ply.inv.maxitems + 1		ply:AddItem(item, 1)				ply:EmitSound("items/ammo_pickup.wav", 100, 100)				ent:Remove()		ply.canuse = false		timer.Create("canuse" .. ply:UniqueID(), 1, 1,function() ply.canuse = true end)		return false	endhook.Add("PocketUse","DrpPlyUse",plyuse)local function plysay(ply, text, tm, death)    if string.sub(text, 1, 4) == "!inv" then		ply:ConCommand("drp_showinv")        return ""    endendhook.Add("PlayerSay","DrpPlySay",plysay)local meta = FindMetaTable("Player")function meta:SaveInv()	local strSteamID = string.Replace(self:SteamID(), ":", "_")		file.Write("drpinv/" .. strSteamID .. ".txt", util.TableToJSON(self.inv))	endfunction meta:SendInv()	net.Start("clearinv")	net.Send(self)		for k,v in pairs(self.inv) do		if  k != "maxitems" then					net.Start( "item" )				net.WriteInt(k,32)				net.WriteTable(v)			net.Send(self)					end	end	endfunction meta:SendItem(k)	net.Start( "item" )		net.WriteInt(k,32)		net.WriteTable(self.inv[k])		print("send",k)	net.Send(self)	endfunction meta:RemoveItem(k)	print("removeitem",k)	net.Start( "itemr" )		net.WriteInt(k,32)	net.Send(self)	endfunction meta:AddItem(str, amt,k)	if amt>0 then		local k = math.random(429496)		while self.inv[k] != nil do			k = math.random(429496)		end		self.inv[k] = str		self:SaveInv()		self:SendItem(k)		else		print("removing",k)		self.inv[k] = nil		self:RemoveItem(k)	endendnet.Receive( "dropitem", function(len, ply)  	print("dropitem")		for k,v in pairs(ply.inv) do		print(k,v)	end	local use = net.ReadBool()	local item = net.ReadInt(32)		print(item)	local k = item	if !item or ply.inv[item] == nil then		print("dropitemgovno")		return	end		item = ply.inv[item]	if ply:isArrested() then		return	end	print("dropitem2")	local pos = ply:EyePos()	local tracedata = {}	tracedata.start = pos	tracedata.endpos = tracedata.start + ply:GetAimVector() * 85	tracedata.filter = ply	local tr = util.TraceLine(tracedata)		local ent = ents.Create(item.class)	ent:SetPos(tr.HitPos)	ent.ShareGravgun = true	ent.nodupe = true	print(item.itype)	if  item.itype=="swep" then		ent:SetWeaponClass(item.w_class)		ent:SetModel(item.model)		ent.ammoadd = item.ammoadd or ent.ammoadd		ent.clip1 = item.clip1 or ent.clip1	end	ent:Spawn()	ent:Activate()	if use then		ent:Use(ply, ply, SIMPLE_USE, 0)	end	ply.inv.maxitems = ply.inv.maxitems - 1	ply:AddItem(item, -1,k)end)