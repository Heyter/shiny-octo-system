 --#NoSimplerr#local maxitems = CreateConVar( "drp_maxitems", "20", { FCVAR_REPLICATED, FCVAR_ARCHIVE } )local maxitemspremiun CreateConVar("drp_maxitems_prim","30",{ FCVAR_REPLICATED, FCVAR_ARCHIVE })util.AddNetworkString("clearinv")util.AddNetworkString("item")util.AddNetworkString("useitem")util.AddNetworkString("dropitem")local function CreateFolder()	if not file.IsDir("drpinv", "DATA") then        file.CreateDir("drpinv")    endendhook.Add( "Initialize", "FolderCreate", CreateFolder )local function plyjoin(ply)	local strSteamID = string.Replace(ply:SteamID(), ":", "_")	local path = "drpinv/" .. strSteamID .. ".txt"	if file.Exists( path, "DATA" ) then		ply.inv = util.JSONToTable(file.Read(path))		DarkRP.notify(ply, 0, 4, "Welcome back " .. ply:Nick() .. "! Your inventory has been loaded.")	else		ply.inv = {}		ply.inv.maxitems = 0		ply:SaveInv()		DarkRP.notify(ply, 0, 4, "На сервере присутствует постоянный инвентарь, используй предмет Pocket для взаимодействия с ним")	end	ply:SendInv()	ply.canuse = true	endhook.Add("PlayerInitialSpawn","DrpInvSpawn",plyjoin)local function plydis(ply)	ply:SaveInv()	timer.Destroy("canuse" .. ply:UniqueID())endhook.Add("PlayerDisconnected","DrpPlyLeave",plydis)local function plyuse(ply, ent)	if items[ent:GetClass()] or ent:GetClass() == "spawned_weapon" then		if ent:GetClass() == "spawned_weapon" then			class = ent:GetWeaponClass()		else 			class = ent:GetClass()		end		if !ply.inv[class] then			ply.inv[class] = 0		end		local max = 0		if isDonator(ply) then			max = maxitems:GetInt()		else			max = maxitemspremiun:GetInt()		end		if ply.inv.maxitems >= max then			DarkRP.notify(ply, 1, 4, "Your inventory is full!")						ply.canuse = false			timer.Create("canuse" .. ply:UniqueID(), 1, 1,function() ply.canuse = true end)			return false		end						ply.inv.maxitems = ply.inv.maxitems + 1		ply:AddItem(class, 1)				ply:EmitSound("items/ammo_pickup.wav", 100, 100)				ent:Remove()		ply.canuse = false		timer.Create("canuse" .. ply:UniqueID(), 1, 1,function() ply.canuse = true end)		return false	endendhook.Add("PocketUse","DrpPlyUse",plyuse)local function plysay(ply, text, tm, death)    if string.sub(text, 1, 4) == "!inv" then		ply:ConCommand("drp_showinv")        return ""    endendhook.Add("PlayerSay","DrpPlySay",plysay)local meta = FindMetaTable("Player")function meta:SaveInv()	local strSteamID = string.Replace(self:SteamID(), ":", "_")		file.Write("drpinv/" .. strSteamID .. ".txt", util.TableToJSON(self.inv))	endfunction meta:SendInv()	net.Start("clearinv")	net.Send(self)		for k,v in pairs(self.inv) do		if type(v) != "table" and k != "maxitems" then					net.Start( "item" )				net.WriteString(k)				net.WriteFloat(v)			net.Send(self)					end	end	endfunction meta:SendItem(str)	net.Start( "item" )		net.WriteString(str)		net.WriteFloat(self.inv[str])	net.Send(self)	endfunction meta:AddItem(str, amt)		if items[str] then		self.inv[str] = self.inv[str] + amt	end	self:SaveInv()	self:SendItem(str)	endnet.Receive( "dropitem", function(len, ply)  	local item = net.ReadString()	if !item or ply.inv[item] == nil then		return	end		if ply.inv[item] < 1 then		DarkRP.notify(ply, 1, 4, "Nice try. You dont have any of that left.")		return	end		if ply:isArrested() then		return	end		local pos = ply:EyePos()	local tracedata = {}	tracedata.start = pos	tracedata.endpos = tracedata.start + ply:GetAimVector() * 85	tracedata.filter = ply	local tr = util.TraceLine(tracedata)		if not items[item].item then		class = "spawned_weapon"	else		class = item	end	local ent = ents.Create(class)	ent:SetPos(tr.HitPos)	ent.ShareGravgun = true	ent.nodupe = true	if not items[item].item then		ent:SetModel(items[item].model)		ent:SetWeaponClass(item)	end	ent:Spawn()	ent:Activate()	ply.inv.maxitems = ply.inv.maxitems - 1	ply:AddItem(item, -1)end)net.Receive( "useitem", function(len, ply)  	local item = net.ReadString()		if !item or ply.inv[item] == nil then		return	end		if ply.inv[item] < 1 then		DarkRP.notify(ply, 1, 4, "Nice try. You dont have any of that left.")		return	end		if ply:isArrested() then		return	end		local ent = ents.Create(item)	ent:SetPos(ply:GetPos())	if ent.dt then		ent.dt.owning_ent = ply	end	ent.ShareGravgun = true	ent.nodupe = true	ent:Spawn()	ent:Activate()		if not ply.maxFoods then		ply.maxFoods = 0	end		ent:Use(ply, ply, SIMPLE_USE, 0)		ply.inv.maxitems = ply.inv.maxitems - 1	ply:AddItem(item, -1)end)